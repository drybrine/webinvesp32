(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{1111:(e,t,a)=>{"use strict";a.d(t,{AdminGuard:()=>o});var n=a(5155),s=a(5695),r=a(6539),i=a(2115);function o(e){let{children:t}=e,a=(0,s.usePathname)(),o=(0,s.useRouter)(),{isAuthenticated:c,isLoading:l}=(0,r.w)();return((0,i.useEffect)(()=>{l||c||"/login"===a||o.replace("/login")},[c,l,a,o]),(0,i.useEffect)(()=>{!l&&c&&"/login"===a&&(window.location.href="/")},[c,l,a]),l)?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"Memeriksa sesi..."})]})}):"/login"===a?c?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"w-6 h-6 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,n.jsx)("p",{className:"mt-2 text-gray-600",children:"Mengarahkan ke dashboard..."})]})}):(0,n.jsx)(n.Fragment,{children:t}):c?(0,n.jsx)(n.Fragment,{children:t}):(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"w-6 h-6 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,n.jsx)("p",{className:"mt-2 text-gray-600",children:"Mengarahkan ke login..."})]})})}},1118:(e,t,a)=>{"use strict";a.d(t,{default:()=>N});var n=a(5155),s=a(2115),r=a(6874),i=a.n(r),o=a(5695),c=a(3999),l=a(2713),d=a(4783),u=a(6308),m=a(381),h=a(3311),x=a(5670),p=a(4416),g=a(7168),v=a(6539),k=a(8145),f=a(4186),j=a(4835),y=a(7133);function b(){let{sessionTimeLeft:e,formatTimeLeft:t,logout:a,isAuthenticated:s}=(0,v.w)(),r=Math.floor(e/6e4),i=r<=5,o=r<=2;return!s||e<=0?null:(0,n.jsxs)(y.rI,{children:[(0,n.jsx)(y.ty,{asChild:!0,children:(0,n.jsxs)(g.$,{variant:"ghost",size:"sm",className:"gap-2",children:[(0,n.jsx)(f.A,{className:"h-4 w-4 ".concat(o?"text-red-500":i?"text-orange-500":"text-green-500")}),(0,n.jsx)(k.E,{variant:o?"destructive":i?"secondary":"outline",className:"text-xs",children:t()})]})}),(0,n.jsxs)(y.SQ,{align:"end",className:"w-56",children:[(0,n.jsxs)(y.lp,{className:"flex items-center gap-2",children:[(0,n.jsx)(f.A,{className:"h-4 w-4"}),"Status Sesi"]}),(0,n.jsx)(y.mB,{}),(0,n.jsxs)("div",{className:"px-2 py-2 text-sm",children:[(0,n.jsx)("p",{className:"font-medium",children:o?"Sesi akan berakhir!":i?"Sesi hampir berakhir":"Sesi aktif"}),(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Waktu tersisa: ",t()]}),i&&(0,n.jsx)("p",{className:"text-xs text-orange-600 mt-1",children:"Lakukan aktivitas untuk memperpanjang sesi"})]}),(0,n.jsx)(y.mB,{}),(0,n.jsxs)(y._2,{onClick:()=>a(),className:"text-red-600 focus:text-red-600 focus:bg-red-50",children:[(0,n.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Logout Sekarang"]})]})]})}let w=[{name:"Dashboard",href:"/",icon:l.A,color:"from-blue-500 to-purple-500"},{name:"Transaksi",href:"/transaksi",icon:u.A,color:"from-emerald-500 to-teal-500"},{name:"Absensi",href:"/absensi",icon:x.A,color:"from-orange-500 to-red-500"},{name:"Pengaturan",href:"/pengaturan",icon:m.A,color:"from-purple-500 to-pink-500"}];function N(){let[e,t]=(0,s.useState)(!1),a=(0,o.usePathname)();return"/login"===a?null:(0,n.jsxs)("nav",{className:"glass-morphism border-b border-white/20 sticky top-0 z-50 shadow-large backdrop-blur-2xl",children:[(0,n.jsx)("div",{className:"max-w-7xl mx-auto mobile-padding",children:(0,n.jsxs)("div",{className:"flex justify-between h-14 sm:h-16 lg:h-18",children:[(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3 group",children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 gradient-primary rounded-xl sm:rounded-2xl flex items-center justify-center shadow-colored interactive-scale group-hover:shadow-extra-large transition-all duration-300",children:(0,n.jsx)(h.A,{className:"w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6 text-white animate-pulse"})}),(0,n.jsx)("div",{className:"absolute -top-0.5 -right-0.5 sm:-top-1 sm:-right-1 w-3 h-3 sm:w-4 sm:h-4 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full animate-bounce-gentle"})]}),(0,n.jsx)("div",{className:"hidden xs:block",children:(0,n.jsxs)("div",{className:"space-y-0.5 sm:space-y-1",children:[(0,n.jsx)("span",{className:"text-xl sm:text-2xl lg:text-3xl font-bold gradient-text tracking-tight",children:"StokManager"}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground font-semibold tracking-wide uppercase opacity-75",children:"Smart Inventory System"})]})}),(0,n.jsx)("span",{className:"text-xl sm:text-2xl font-bold gradient-text xs:hidden tracking-tight",children:"SM"})]})}),(0,n.jsx)("div",{className:"hidden md:ml-6 lg:ml-10 md:flex md:space-x-2 lg:space-x-4",children:w.map(e=>{let t=e.icon,s=a===e.href;return(0,n.jsxs)(i(),{href:e.href,className:(0,c.cn)("relative inline-flex items-center px-3 lg:px-6 py-2 lg:py-3 text-sm font-semibold rounded-xl lg:rounded-2xl transition-all duration-300 overflow-hidden group btn-modern min-h-[44px]",s?"bg-gradient-to-r ".concat(e.color," text-white shadow-colored transform scale-105"):"text-foreground/80 hover:text-foreground hover:bg-accent/50 hover:shadow-medium hover:scale-102"),children:[s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-50 animate-pulse rounded-xl lg:rounded-2xl"}),(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-scan-line rounded-xl lg:rounded-2xl"})]}),(0,n.jsx)(t,{className:(0,c.cn)("w-4 h-4 lg:w-5 lg:h-5 mr-2 lg:mr-3 relative z-10 transition-transform duration-300",s?"animate-bounce-gentle":"group-hover:scale-110")}),(0,n.jsx)("span",{className:"hidden lg:block relative z-10 font-medium",children:e.name}),(0,n.jsx)("span",{className:"lg:hidden relative z-10 font-medium text-xs",children:e.name}),s&&(0,n.jsx)("div",{className:"absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-1.5 h-1.5 lg:w-2 lg:h-2 bg-white rounded-full shadow-medium animate-pulse"})]},e.name)})})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"hidden sm:block",children:(0,n.jsx)(b,{})}),(0,n.jsx)("div",{className:"md:hidden flex items-center",children:(0,n.jsx)(g.$,{variant:"ghost",size:"sm",onClick:()=>t(!e),className:"relative p-2 sm:p-3 rounded-xl hover:bg-accent/50 hover:shadow-medium interactive-scale transition-all duration-300 min-h-[44px] min-w-[44px]",children:(0,n.jsx)("div",{className:"relative w-5 h-5 sm:w-6 sm:h-6",children:e?(0,n.jsx)(p.A,{className:"w-5 h-5 sm:w-6 sm:h-6 text-foreground transition-transform duration-300 rotate-180"}):(0,n.jsx)(d.A,{className:"w-5 h-5 sm:w-6 sm:h-6 text-foreground transition-transform duration-300"})})})})]})]})}),e&&(0,n.jsx)("div",{className:"md:hidden",children:(0,n.jsx)("div",{className:"glass-morphism border-t border-white/10 mobile-scroll",children:(0,n.jsxs)("div",{className:"mobile-padding py-3 space-y-2",children:[(0,n.jsx)("div",{className:"pb-2 border-b border-white/10",children:(0,n.jsx)(b,{})}),w.map(e=>{let s=e.icon,r=a===e.href;return(0,n.jsxs)(i(),{href:e.href,onClick:()=>t(!1),className:(0,c.cn)("flex items-center px-4 py-3 text-base font-semibold rounded-xl transition-all duration-300 group mobile-full interactive-scale min-h-[52px]",r?"bg-gradient-to-r ".concat(e.color," text-white shadow-colored"):"text-foreground/80 hover:text-foreground hover:bg-accent/50 hover:shadow-medium"),children:[(0,n.jsx)(s,{className:(0,c.cn)("w-5 h-5 mr-3 transition-transform duration-300",r?"text-white animate-bounce-gentle":"group-hover:scale-110")}),(0,n.jsx)("span",{className:(0,c.cn)("font-medium",r?"text-white":""),children:e.name}),r&&(0,n.jsx)("div",{className:"ml-auto w-2 h-2 bg-white rounded-full animate-pulse"})]},e.name)})]})})})]})}},2008:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,9324,23)),Promise.resolve().then(a.bind(a,1111)),Promise.resolve().then(a.bind(a,2797)),Promise.resolve().then(a.bind(a,1118)),Promise.resolve().then(a.bind(a,4962)),Promise.resolve().then(a.bind(a,2450)),Promise.resolve().then(a.bind(a,9748)),Promise.resolve().then(a.bind(a,5823)),Promise.resolve().then(a.bind(a,5038)),Promise.resolve().then(a.t.bind(a,5327,23))},2450:(e,t,a)=>{"use strict";a.d(t,{RealtimeAttendanceProvider:()=>m});var n=a(5155),s=a(2115),r=a(5695),i=a(1115),o=a(8915),c=a(2464),l=a(3580),d=a(8542);let u=(0,s.createContext)({isProcessing:!1,lastProcessedNim:null,processCount:0});function m(e){let{children:t}=e,a=(0,r.usePathname)(),{addAttendance:m,attendance:h}=(0,c.qf)(),{toast:x}=(0,l.dj)(),[p,g]=(0,s.useState)(!1),[v,k]=(0,s.useState)(null),[f,j]=(0,s.useState)(0),[y,b]=(0,s.useState)(new Set),[w,N]=(0,s.useState)(0),S="/absensi"===a;(0,s.useEffect)(()=>{if(!S||!(0,o.Gg)()||!o.OO)return;let e=setInterval(()=>{let e=Date.now();b(t=>{let a=new Set;return t.forEach(t=>{let n=t.split("-");n.length>=2&&e-1e3*parseInt(n[n.length-1])<15e3&&a.add(t)}),console.log("\uD83E\uDDF9 Cleaned up processed scans: ".concat(t.size," -> ").concat(a.size)),a})},3e4),t=(0,i.KR)(o.OO,"scans"),a=(0,i.Zy)(t,e=>{let t=e.val();if(t){let e=Object.keys(t).map(e=>({id:e,...t[e]})).sort((e,t)=>(t.timestamp||0)-(e.timestamp||0));if(e.length>0){let t=e[0],a=Date.now(),n=t.timestamp||0;if("attendance"!==t.mode&&"attendance_scan"!==t.type){console.log("⏭️ Skipping non-attendance scan in attendance provider: ".concat(t.barcode," (mode: ").concat(t.mode||"unknown",", type: ").concat(t.type||"unknown",")"));return}console.log("\uD83D\uDCDD Processing attendance scan: ".concat(t.barcode," (mode: ").concat(t.mode||"unknown",", type: ").concat(t.type||"unknown",")"));let s="".concat(t.barcode,"-").concat(Math.floor(n/1e3)),r=Date.now();if(v===t.barcode&&r-w<3e3){console.log("\uD83D\uDEAB Debounced duplicate scan: ".concat(t.barcode," (").concat(r-w,"ms ago)"));return}if(y.has(s)){console.log("\uD83D\uDEAB Already processed scan: ".concat(t.barcode," (").concat(s,")"));return}let i=Array.from(y).find(e=>e.startsWith(t.barcode+"-")&&r-1e3*parseInt(e.split("-")[1])<15e3);if(i){console.log("\uD83D\uDEAB Duplicate NIM within timeout: ".concat(t.barcode," (previous: ").concat(i,")"));return}a-n<15e3&&(console.log("✅ Processing new ESP32 scan: ".concat(t.barcode," (").concat(s,")")),x({title:"\uD83D\uDCF1 QR Code Terdeteksi!",description:"ESP32 Scanner mendeteksi QR Code: ".concat(t.barcode)}),A(t.barcode,t.deviceId||"esp32",s))}}});return()=>{clearInterval(e),t&&a&&(0,i.AU)(t,"value",a)}},[S,y,v,w]),(0,s.useEffect)(()=>(console.log("\uD83D\uDD27 Starting device status monitor from attendance provider..."),(0,d.Zh)(),()=>{console.log("\uD83D\uDED1 Stopping device status monitor from attendance provider..."),(0,d.Ze)()}),[]);let A=async(e,t,a)=>{try{var n;g(!0),b(e=>new Set(e.add(a)));let s=e.trim();if(!s||s.length<8){x({title:"QR Code Tidak Valid",description:"Format NIM tidak valid: ".concat(s),variant:"destructive"});return}let r=new Date().toDateString(),i=h.filter(e=>new Date(e.timestamp).toDateString()===r).find(e=>e.nim===s);if(i){x({title:"⚠️ Sudah Absen",description:"NIM ".concat(s," sudah melakukan absensi hari ini pada ").concat(new Date(i.timestamp).toLocaleTimeString("id-ID")),variant:"destructive"});return}await m(s,"",t),k(s),N(Date.now()),j(e=>e+1),x({title:"\uD83C\uDF89 QR Code Berhasil Terdeteksi!",description:"✅ NIM ".concat(s," berhasil dicatat melalui ESP32 Scanner (").concat(t,") pada ").concat(new Date().toLocaleTimeString("id-ID"))}),(null===(n=window.navigator)||void 0===n?void 0:n.vibrate)&&window.navigator.vibrate([200,100,200]);try{let e=new Audio("/success.mp3");e.volume=.7,e.play().catch(()=>console.log("Success sound not available"))}catch(e){console.log("Success sound error:",e)}console.log("\uD83C\uDFAF ESP32 Attendance Success: NIM ".concat(s," scanned by ").concat(t," at ").concat(new Date().toISOString()))}catch(t){console.error("Error processing ESP32 attendance scan:",t),x({title:"❌ Error Absensi",description:"Gagal memproses absensi untuk NIM ".concat(e,": ").concat(t),variant:"destructive"})}finally{g(!1),setTimeout(()=>{g(!1)},3e3)}};return(0,n.jsx)(u.Provider,{value:{isProcessing:p,lastProcessedNim:v,processCount:f},children:t})}},2797:(e,t,a)=>{"use strict";a.d(t,{DeviceStatusMonitorProvider:()=>i});var n=a(5155),s=a(2115),r=a(8542);function i(e){let{children:t}=e;return(0,s.useEffect)(()=>(console.log("\uD83D\uDD27 DeviceStatusMonitorProvider initialized"),(0,r.Zh)(),()=>{console.log("\uD83D\uDD27 DeviceStatusMonitorProvider cleanup"),(0,r.Ze)()}),[]),(0,n.jsx)(n.Fragment,{children:t})}},4962:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var n=a(2115);function s(){return(0,n.useEffect)(()=>{if("performance"in window){let e=new PerformanceObserver(e=>{for(let t of e.getEntries())"largest-contentful-paint"===t.entryType&&console.log("LCP:",t.startTime),"first-input"===t.entryType&&console.log("FID:",t.processingStart-t.startTime),"layout-shift"!==t.entryType||t.hadRecentInput||console.log("CLS:",t.value)});try{e.observe({entryTypes:["largest-contentful-paint","first-input","layout-shift"]})}catch(e){console.log("Performance Observer not fully supported")}return window.addEventListener("load",()=>{setTimeout(()=>{let e=performance.getEntriesByType("navigation")[0];e&&(console.log("Page Load Time:",e.loadEventEnd-e.fetchStart),console.log("DOM Content Loaded:",e.domContentLoadedEventEnd-e.fetchStart))},0)}),()=>{e.disconnect()}}},[]),null}},5823:(e,t,a)=>{"use strict";a.d(t,{default:()=>s});var n=a(2115);function s(){return(0,n.useEffect)(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker registered successfully:",e.scope)}).catch(e=>{console.log("Service Worker registration failed:",e)})},[]),null}},6288:(e,t,a)=>{"use strict";a.d(t,{X:()=>n.A});var n=a(4416)},6539:(e,t,a)=>{"use strict";a.d(t,{w:()=>c});var n=a(2115),s=a(5695);let r="lastActivity",i="isAdmin",o="sessionStart";function c(){let[e,t]=(0,n.useState)(!1),[a,c]=(0,n.useState)(0),[l,d]=(0,n.useState)(!0);(0,s.useRouter)();let u=(0,n.useCallback)(()=>{{let e=Date.now();localStorage.setItem(r,e.toString())}},[]),m=(0,n.useCallback)((e,a)=>{if("admin"===e&&"admin123"===a){let e=Date.now();return localStorage.setItem(i,"true"),localStorage.setItem(o,e.toString()),localStorage.setItem(r,e.toString()),t(!0),c(18e5),d(!1),setTimeout(()=>{window.location.href="/"},100),!0}return!1},[]),h=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&localStorage.setItem("wasLoggedIn","true"),localStorage.removeItem(i),localStorage.removeItem(o),localStorage.removeItem(r),t(!1),c(0),d(!1),window.location.href="/login"},[]),x=(0,n.useCallback)(()=>{let e=localStorage.getItem(i),t=localStorage.getItem(r);if(!e||"true"!==e||!t)return!1;let a=Date.now()-parseInt(t);return!(a>18e5)&&(c(18e5-a),!0)},[]);(0,n.useEffect)(()=>{let t=["mousedown","mousemove","keypress","scroll","touchstart","click"],a=()=>{e&&u()};return t.forEach(e=>{document.addEventListener(e,a,!0)}),()=>{t.forEach(e=>{document.removeEventListener(e,a,!0)})}},[e,u]),(0,n.useEffect)(()=>{let a=x();if(t(a),d(!1),!a&&localStorage.getItem(i)){h(!0);return}let n=setInterval(()=>{!x()&&e&&h(!0)},6e4);return()=>clearInterval(n)},[x,h,e]);let p=e=>{let t=Math.floor(e/6e4),a=Math.floor(e%6e4/1e3);return"".concat(t,":").concat(a.toString().padStart(2,"0"))};return{isAuthenticated:e,isLoading:l,sessionTimeLeft:a,formatTimeLeft:()=>p(a),login:m,logout:h,updateActivity:u}}},8173:(e,t,a)=>{"use strict";a.d(t,{Jl:()=>n.A,c_:()=>s.A,jl:()=>r.A});var n=a(5196),s=a(3052),r=a(9428)},8542:(e,t,a)=>{"use strict";a.d(t,{Ze:()=>i,Zh:()=>r});class n{start(){if(this.isRunning){console.log("⚠️ DeviceStatusMonitor already running");return}console.log("\uD83D\uDE80 Starting DeviceStatusMonitor..."),this.isRunning=!0,setTimeout(()=>{this.checkDeviceStatus()},1e3),this.intervalId=setInterval(()=>{"visible"===document.visibilityState&&this.checkDeviceStatus()},this.CHECK_INTERVAL),console.log("✅ DeviceStatusMonitor started (checking every ".concat(this.CHECK_INTERVAL/1e3,"s)"))}stop(){if(!this.isRunning){console.log("⚠️ DeviceStatusMonitor not running");return}console.log("\uD83D\uDED1 Stopping DeviceStatusMonitor..."),this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.isRunning=!1,console.log("✅ DeviceStatusMonitor stopped")}async checkDeviceStatus(){try{console.log("\uD83D\uDD0D Running automated device status check...");let e=this.API_ENDPOINT.startsWith("http")?this.API_ENDPOINT:"".concat(window.location.origin).concat(this.API_ENDPOINT),t={method:"POST",headers:{"Content-Type":"application/json","X-Internal-Call":"true"}};"undefined"!=typeof AbortSignal&&AbortSignal.timeout&&(t.signal=AbortSignal.timeout(1e4));let a=await fetch(e,t);if(a.ok){let e=await a.json();e.updatedDevices>0?(console.log("\uD83D\uDCF1 Device status updates: ".concat(e.updatedDevices," devices (").concat(e.onlineDevices," online, ").concat(e.offlineDevices," offline)")),window.dispatchEvent(new CustomEvent("deviceStatusUpdated",{detail:e}))):console.log("ℹ️ Device status check completed - no updates needed")}else{console.error("❌ Device status check failed:",a.status,a.statusText);try{let e=await a.text();console.error("Error details:",e)}catch(e){console.error("Could not parse error response")}window.dispatchEvent(new CustomEvent("deviceStatusError",{detail:{status:a.status,statusText:a.statusText,timestamp:new Date().toISOString()}}))}}catch(e){console.error("❌ Error in automated device status check:",e),e instanceof TypeError&&e.message.includes("Failed to fetch")?console.error("\uD83C\uDF10 Network connection error - check if server is running"):e instanceof DOMException&&"AbortError"===e.name?console.error("⏱️ Request timeout - server taking too long to respond"):console.error("\uD83D\uDD27 Unexpected error in device status monitor"),window.dispatchEvent(new CustomEvent("deviceStatusError",{detail:{error:e instanceof Error?e.message:"Network error",errorType:e instanceof TypeError?"network":"unknown",timestamp:new Date().toISOString()}}))}}getStatus(){return{isRunning:this.isRunning,checkInterval:this.CHECK_INTERVAL,nextCheckIn:this.isRunning?this.CHECK_INTERVAL:null}}constructor(){this.intervalId=null,this.isRunning=!1,this.CHECK_INTERVAL=2e4,this.API_ENDPOINT="/api/check-device-status",console.log("\uD83D\uDD27 DeviceStatusMonitor initialized")}}let s=null;function r(){return s||(s=new n),s.start(),s}function i(){s&&s.stop()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{r()}):r(),window.addEventListener("pagehide",()=>{console.log("\uD83D\uDCF1 Page hiding, stopping device status monitor..."),i()}),window.addEventListener("pageshow",e=>{e.persisted&&(console.log("\uD83D\uDCF1 Page restored from bfcache, restarting device status monitor..."),r())}),document.addEventListener("visibilitychange",()=>{document.hidden?(console.log("\uD83D\uDCF1 Page hidden, pausing device status monitor..."),i()):(console.log("\uD83D\uDCF1 Page visible, resuming device status monitor..."),r())}),window.addEventListener("blur",()=>{console.log("\uD83D\uDCF1 Window lost focus, pausing device status monitor..."),i()}),window.addEventListener("focus",()=>{document.hidden||(console.log("\uD83D\uDCF1 Window gained focus, resuming device status monitor..."),r())})},9324:()=>{},9748:(e,t,a)=>{"use strict";a.d(t,{RealtimeScanProvider:()=>A});var n=a(5155),s=a(2115),r=a(5695),i=a(1115),o=a(8915),c=a(9840),l=a(7168),d=a(9852),u=a(2714),m=a(8145),h=a(3580),x=a(2464),p=a(1243);a(1908);var g=a(4516),v=a(7712),k=a(7108);a(7039);var f=a(4616),j=a(9799),y=a(1539),b=a(4130),w=a.n(b);function N(e){let{barcode:t,isOpen:a,onClose:r}=e,{items:i,addItem:b,updateItem:N}=(0,x.j6)(),{toast:S}=(0,h.dj)(),[A,D]=(0,s.useState)(null),[E,C]=(0,s.useState)("quickAction"),[P,I]=(0,s.useState)(1),[T,q]=(0,s.useState)(0),[M,L]=(0,s.useState)({name:"",barcode:t||"",category:"Umum",quantity:0,minStock:5,price:0,description:"",location:"",supplier:""});(0,s.useEffect)(()=>{if(t){let e=i.find(e=>e.barcode===t);D(e||null),e?C("quickAction"):(C("addNew"),L(e=>({...e,barcode:t}))),I(1),q(0)}else D(null),C("info")},[t,i,a]);let O=e=>{let{name:t,value:a}=e.target;L(e=>({...e,[t]:"quantity"===t||"minStock"===t||"price"===t?Number(a):a}))},R=async()=>{try{if(!M){S({title:"Error",description:"Data produk tidak lengkap.",variant:"destructive"});return}if(i.some(e=>e.barcode===M.barcode)){S({title:"Error",description:"Barcode sudah terdaftar untuk produk lain.",variant:"destructive"});return}let e={...M,lastUpdated:new Date().toISOString()};await b(e),S({title:"✅ Produk Ditambahkan",description:"".concat(M.name," berhasil ditambahkan.")}),r()}catch(e){S({title:"Error",description:"Gagal menambahkan produk.",variant:"destructive"})}},J=async()=>{if(A&&!(P<=0))try{let e=A.quantity+P;await N(A.id,{quantity:e});let t={type:"in",productName:A.name,productBarcode:A.barcode,quantity:P,unitPrice:A.price,totalAmount:P*A.price,reason:"Stock In via Quick Action Popup",operator:"User"};await o.$J.addTransaction(t),S({title:"\uD83D\uDCE6 Stock In Berhasil",description:"+".concat(P," ").concat(A.name," | Stok: ").concat(A.quantity," → ").concat(e,". Transaksi dicatat.")}),r()}catch(e){console.error("Error during stock in or transaction:",e),S({title:"Error",description:"Gagal melakukan stock in atau mencatat transaksi.",variant:"destructive"})}},F=async()=>{if(A&&!(P<=0)){if(A.quantity<P){S({title:"⚠️ Stok Tidak Cukup",description:"Stok tersedia: ".concat(A.quantity,", diminta: ").concat(P),variant:"destructive"});return}try{let e=Math.max(0,A.quantity-P);await N(A.id,{quantity:e});let t={type:"out",productName:A.name,productBarcode:A.barcode,quantity:-P,unitPrice:A.price,totalAmount:-P*A.price,reason:"Stock Out via Quick Action Popup",operator:"User"};await o.$J.addTransaction(t),S({title:"\uD83D\uDCE4 Stock Out Berhasil",description:"-".concat(P," ").concat(A.name," | Stok: ").concat(A.quantity," → ").concat(e,". Transaksi dicatat.")}),r()}catch(e){console.error("Error during stock out or transaction:",e),S({title:"Error",description:"Gagal melakukan stock out atau mencatat transaksi.",variant:"destructive"})}}},B=async()=>{if(!A||0===T){S({title:"Info",description:"Masukkan jumlah penyesuaian yang valid."});return}try{let e=Math.max(0,A.quantity+T);await N(A.id,{quantity:e});let t={type:"adjustment",productName:A.name,productBarcode:A.barcode,quantity:T,unitPrice:A.price,totalAmount:T*A.price,reason:"Manual Stock Adjustment via Popup",operator:"User"};await o.$J.addTransaction(t),S({title:"\uD83D\uDCE6 Stok Disesuaikan",description:"Stok ".concat(A.name," disesuaikan ").concat(T>0?"+":"").concat(T,". Stok baru: ").concat(e,". Transaksi dicatat.")}),C("info"),q(0)}catch(e){console.error("Error during manual stock adjustment or transaction:",e),S({title:"Error",description:"Gagal menyesuaikan stok atau mencatat transaksi.",variant:"destructive"})}};return a?(0,n.jsx)(c.lG,{open:a,onOpenChange:e=>!e&&r(),children:(0,n.jsxs)(c.Cf,{className:"sm:max-w-md md:max-w-lg lg:max-w-xl max-h-[90vh]",children:[(0,n.jsxs)(c.c7,{children:[(0,n.jsx)(c.L3,{children:"addNew"===E?"Tambah Produk Baru":"quickAction"===E?"Aksi Cepat":"manualAdjust"===E?"Penyesuaian Manual":A?A.name:"Informasi Produk"}),(0,n.jsx)(c.rr,{children:"addNew"===E?"Tambahkan produk baru ke inventaris":"quickAction"===E?"Ubah stok dengan cepat":"manualAdjust"===E?"Sesuaikan stok secara manual":"Detail informasi produk"})]}),(()=>{if(!A&&"addNew"!==E)return(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)(k.A,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),(0,n.jsxs)("p",{className:"text-gray-500",children:["Produk dengan barcode ",(0,n.jsx)("span",{className:"font-mono",children:t})," tidak ditemukan."]}),(0,n.jsx)(l.$,{onClick:()=>C("addNew"),className:"mt-4",children:"Tambah Produk Baru"})]});switch(E){case"quickAction":if(!A)return(0,n.jsx)("p",{children:"Produk tidak ditemukan."});return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("div",{className:"p-4 border rounded-lg bg-gray-50 dark:bg-gray-800",children:(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-md flex items-center justify-center",children:(0,n.jsx)(k.A,{className:"h-8 w-8 text-gray-500 dark:text-gray-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:A.name}),(0,n.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Barcode: ",(0,n.jsx)("span",{className:"font-mono",children:A.barcode})]}),(0,n.jsxs)(m.E,{variant:A.quantity<=A.minStock?"destructive":"secondary",children:["Stok: ",A.quantity]})]})]})}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)(u.J,{htmlFor:"quickActionAmount",children:"Jumlah Aksi Cepat"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(l.$,{variant:"outline",size:"icon",onClick:()=>I(Math.max(1,P-1)),children:(0,n.jsx)(v.A,{className:"h-4 w-4"})}),(0,n.jsx)(d.p,{id:"quickActionAmount",type:"number",value:P,onChange:e=>I(Math.max(1,parseInt(e.target.value)||1)),className:"w-20 text-center",min:"1"}),(0,n.jsx)(l.$,{variant:"outline",size:"icon",onClick:()=>I(P+1),children:(0,n.jsx)(f.A,{className:"h-4 w-4"})})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)(l.$,{onClick:J,className:"bg-green-600 hover:bg-green-700 text-white",children:[(0,n.jsx)(f.A,{className:"h-4 w-4 mr-2"})," Stock In"]}),(0,n.jsxs)(l.$,{onClick:F,className:"bg-red-600 hover:bg-red-700 text-white",disabled:A.quantity<P,children:[(0,n.jsx)(v.A,{className:"h-4 w-4 mr-2"})," Stock Out"]})]}),A.quantity<P&&"quickAction"===E&&(0,n.jsx)("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900 border border-yellow-300 dark:border-yellow-700 rounded-md",children:(0,n.jsxs)("div",{className:"flex items-center gap-2 text-yellow-800 dark:text-yellow-200",children:[(0,n.jsx)(p.A,{className:"h-4 w-4"}),(0,n.jsxs)("span",{className:"text-sm",children:["Stok tidak mencukupi untuk stock out sebanyak ",P," unit"]})]})}),(0,n.jsxs)("div",{className:"flex justify-center gap-2 pt-4 border-t dark:border-gray-700",children:[(0,n.jsxs)(l.$,{variant:"outline",size:"sm",onClick:()=>C("info"),children:[(0,n.jsx)(k.A,{className:"h-4 w-4 mr-1"}),"Detail Produk"]}),(0,n.jsxs)(l.$,{variant:"outline",size:"sm",onClick:()=>C("manualAdjust"),children:[(0,n.jsx)(y.A,{className:"h-4 w-4 mr-1"}),"Manual Adjust"]})]})]});case"manualAdjust":if(!A)return(0,n.jsx)("p",{children:"Produk tidak ditemukan."});return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)(c.c7,{children:[(0,n.jsxs)(c.L3,{children:["Penyesuaian Stok Manual: ",A.name]}),(0,n.jsxs)(c.rr,{children:["Stok saat ini: ",A.quantity,". Masukkan jumlah penyesuaian (positif untuk menambah, negatif untuk mengurangi)."]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"manualAdjustmentAmount",children:"Jumlah Penyesuaian"}),(0,n.jsx)(d.p,{id:"manualAdjustmentAmount",type:"number",value:T,onChange:e=>q(parseInt(e.target.value)||0),placeholder:"Contoh: 5 atau -3"})]}),(0,n.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Stok setelah penyesuaian: ",A.quantity+T]}),(0,n.jsxs)(c.Es,{className:"pt-4",children:[(0,n.jsx)(l.$,{variant:"outline",onClick:()=>C("quickAction"),children:"Batal"}),(0,n.jsx)(l.$,{onClick:B,children:"Simpan Penyesuaian"})]})]});case"addNew":return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)(c.c7,{children:[(0,n.jsx)(c.L3,{children:"Tambah Produk Baru"}),(0,n.jsxs)(c.rr,{children:["Barcode ",(0,n.jsx)("span",{className:"font-mono",children:t})," tidak ditemukan. Tambahkan sebagai produk baru."]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[60vh] overflow-y-auto p-1",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"barcode-new",children:"Barcode *"}),(0,n.jsx)(d.p,{id:"barcode-new",name:"barcode",value:M.barcode,onChange:O,readOnly:!0,className:"bg-gray-100 dark:bg-gray-700"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"name",children:"Nama Produk *"}),(0,n.jsx)(d.p,{id:"name",name:"name",value:M.name,onChange:O,placeholder:"Nama produk"})]}),(0,n.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,n.jsx)(u.J,{htmlFor:"description",children:"Deskripsi"}),(0,n.jsx)(d.p,{id:"description",name:"description",value:M.description,onChange:O,placeholder:"Deskripsi singkat produk"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"category",children:"Kategori"}),(0,n.jsxs)("select",{id:"category",name:"category",value:M.category,onChange:O,className:"w-full px-3 py-2 border border-input bg-background rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-ring dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[(0,n.jsx)("option",{value:"Umum",children:"Umum"}),(0,n.jsx)("option",{value:"Elektronik",children:"Elektronik"}),(0,n.jsx)("option",{value:"Pakaian",children:"Pakaian"}),(0,n.jsx)("option",{value:"Makanan",children:"Makanan"}),(0,n.jsx)("option",{value:"Minuman",children:"Minuman"}),(0,n.jsx)("option",{value:"ATK",children:"ATK"}),(0,n.jsx)("option",{value:"Lainnya",children:"Lainnya"})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"quantity",children:"Stok Awal *"}),(0,n.jsx)(d.p,{id:"quantity",name:"quantity",type:"number",value:M.quantity,onChange:O,placeholder:"0",min:"0"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"minStock",children:"Stok Minimum *"}),(0,n.jsx)(d.p,{id:"minStock",name:"minStock",type:"number",value:M.minStock,onChange:O,placeholder:"5",min:"0"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"price",children:"Harga (Rp) *"}),(0,n.jsx)(d.p,{id:"price",name:"price",type:"number",value:M.price,onChange:O,placeholder:"0",min:"0"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"location",children:"Lokasi"}),(0,n.jsx)(d.p,{id:"location",name:"location",value:M.location,onChange:O,placeholder:"Rak A1"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"supplier",children:"Pemasok"}),(0,n.jsx)(d.p,{id:"supplier",name:"supplier",value:M.supplier,onChange:O,placeholder:"Nama pemasok"})]})]}),(0,n.jsxs)(c.Es,{className:"pt-4",children:[(0,n.jsx)(l.$,{variant:"outline",onClick:r,children:"Batal"}),(0,n.jsx)(l.$,{onClick:R,children:"Tambah Produk"})]})]});default:if(!A)return(0,n.jsx)("p",{children:"Produk tidak ditemukan atau belum dipilih."});return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)(c.c7,{children:[(0,n.jsxs)(c.L3,{className:"flex items-center gap-2",children:[(0,n.jsx)(k.A,{className:"h-6 w-6"})," ",A.name]}),(0,n.jsx)(c.rr,{children:"Detail lengkap produk inventaris."})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 text-sm p-1",children:[(0,n.jsx)("div",{className:"md:col-span-2 flex justify-center mb-2",children:A.barcode&&(0,n.jsx)("div",{className:"bg-white p-2 rounded border inline-block",children:(0,n.jsx)(w(),{value:A.barcode,format:"CODE128",width:1.5,height:50,displayValue:!0,fontSize:12,margin:5})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(u.J,{className:"text-xs text-gray-500 dark:text-gray-400",children:"Kategori"}),(0,n.jsx)("p",{className:"font-medium",children:A.category})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(u.J,{className:"text-xs text-gray-500 dark:text-gray-400",children:"Harga"}),(0,n.jsxs)("p",{className:"font-medium",children:["Rp ",A.price.toLocaleString()]})]}),(0,n.jsxs)("div",{className:"md:col-span-2",children:[(0,n.jsx)(u.J,{className:"text-xs text-gray-500 dark:text-gray-400",children:"Deskripsi"}),(0,n.jsx)("p",{className:"font-medium",children:A.description||"-"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(u.J,{className:"text-xs text-gray-500 dark:text-gray-400",children:"Stok Saat Ini:"}),(0,n.jsxs)(m.E,{variant:A.quantity<=A.minStock?"destructive":0===A.quantity?"destructive":"default",className:A.quantity<=A.minStock&&A.quantity>0?"bg-yellow-500 dark:bg-yellow-600":0===A.quantity?"bg-red-600 dark:bg-red-700":"bg-blue-500 dark:bg-blue-600",children:[A.quantity," ",A.quantity<=A.minStock&&A.quantity>0?"(Stok Rendah)":0===A.quantity?"(Stok Habis)":""]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(u.J,{className:"text-xs text-gray-500 dark:text-gray-400",children:"Min. Stok"}),(0,n.jsx)("p",{className:"font-medium",children:A.minStock})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(g.A,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"}),(0,n.jsx)(u.J,{className:"text-xs text-gray-500 dark:text-gray-400",children:"Lokasi:"}),(0,n.jsx)("p",{className:"font-medium",children:A.location||"-"})]}),A.supplier&&(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(j.A,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"}),(0,n.jsx)(u.J,{className:"text-xs text-gray-500 dark:text-gray-400",children:"Pemasok:"}),(0,n.jsx)("p",{className:"font-medium",children:A.supplier})]}),A.createdAt&&(0,n.jsxs)("div",{children:[(0,n.jsx)(u.J,{className:"text-xs text-gray-500 dark:text-gray-400",children:"Dibuat Pada"}),(0,n.jsx)("p",{className:"font-medium",children:new Date(A.createdAt).toLocaleDateString("id-ID")})]}),A.updatedAt&&(0,n.jsxs)("div",{children:[(0,n.jsx)(u.J,{className:"text-xs text-gray-500 dark:text-gray-400",children:"Diperbarui Pada"}),(0,n.jsx)("p",{className:"font-medium",children:new Date(A.updatedAt).toLocaleDateString("id-ID")})]})]}),(0,n.jsxs)(c.Es,{className:"pt-4 border-t dark:border-gray-700",children:[(0,n.jsx)(l.$,{variant:"outline",onClick:()=>C("quickAction"),children:"Aksi Cepat"}),(0,n.jsx)(l.$,{onClick:r,children:"Tutup"})]})]})}})()]})}):null}let S=(0,s.createContext)({isScanning:!1,lastScannedBarcode:null,scanCount:0});function A(e){let{children:t}=e,a=(0,r.usePathname)(),[c,l]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(0),[x,p]=(0,s.useState)(!1),[g,v]=(0,s.useState)(""),k=["/absensi"].includes(a);return(0,s.useEffect)(()=>{if(!(0,o.Gg)()||!o.OO){console.log("Firebase not available for realtime scans");return}let e=(0,i.KR)(o.OO,"scans"),t=(0,i.Zy)(e,e=>{let t=e.val();if(t){let e=Object.keys(t).map(e=>({id:e,...t[e]})).sort((e,t)=>(t.timestamp||0)-(e.timestamp||0));if(e.length>0){let t=e[0],a=Date.now(),n=t.timestamp||0;if(!("inventory"===t.mode||"inventory_scan"===t.type||!t.mode&&!t.type)){console.log("⏭️ Skipping non-inventory scan in scan provider: ".concat(t.barcode," (mode: ").concat(t.mode||"unknown",", type: ").concat(t.type||"unknown",")"));return}console.log("\uD83D\uDCE6 Processing inventory scan: ".concat(t.barcode," (mode: ").concat(t.mode||"unknown",", type: ").concat(t.type||"unknown",")")),a-n<5e3&&t.barcode!==d&&(u(t.barcode),v(t.barcode),h(e=>e+1),l(!0),k||p(!0),setTimeout(()=>{l(!1)},2e3))}}});return()=>{e&&t&&(0,i.AU)(e,"value",t)}},[d,k]),(0,n.jsxs)(S.Provider,{value:{isScanning:c,lastScannedBarcode:d,scanCount:m},children:[t,(0,n.jsx)(N,{barcode:g,isOpen:x,onClose:()=>{p(!1),v("")}})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2533,5874,6209,8779,4313,5180,9290,622,2432,7979,1899,9744,2322,9592,7940,2652,5030,465,3719,408,9741,9473,9219,7499,7358],()=>t(2008)),_N_E=e.O()}]);