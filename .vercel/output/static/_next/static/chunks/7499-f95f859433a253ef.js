"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7499],{2464:(e,t,a)=>{a.d(t,{C6:()=>u,V6:()=>d,iq:()=>f,j6:()=>c,qf:()=>g});var r=a(2115),n=a(1115),o=a(8915);let s={INVENTORY:"inventory_items",SCANS:"scan_records",DEVICES:"device_status",TRANSACTIONS:"transaction_records"},i=e=>{try{let t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return console.error("Error reading from localStorage:",e),null}},l=(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.error("Error saving to localStorage:",e)}};function c(){let[e,t]=(0,r.useState)([]),[a,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e;if(!(0,o.Gg)()||!o.OO){console.log("Firebase not available, using local storage for inventory");let e=i(s.INVENTORY);t(e&&e.length>0?e:[]),u(null),c(!1);return}let a=(0,n.KR)(o.OO,"inventory");return(e=(0,n.Zy)(a,e=>{try{let a=e.val(),r=a?Object.keys(a).map(e=>({...a[e],id:e})):[];t(r),u(null)}catch(e){console.error("Error processing inventory snapshot:",e),u(e.message||"Failed to parse inventory data")}c(!1)},e=>{console.error("Firebase inventory error:",e),u(e.message),c(!1)}))&&o.m6.addListener(e),()=>{e&&e()}},[]);let f=async a=>{if(!(0,o.Gg)()){let r={...a,id:"local_".concat(Date.now()),createdAt:Date.now(),updatedAt:Date.now()},n=[...e,r];return t(n),l(s.INVENTORY,n),r.id}try{return await o.$J.addInventoryItem(a)}catch(e){throw console.error("Error adding item:",e),Error(e instanceof Error?e.message:"Failed to add item")}},g=async(a,r)=>{if(!(0,o.Gg)()){let n=e.map(e=>e.id===a?{...e,...r,updatedAt:Date.now()}:e);t(n),l(s.INVENTORY,n);return}try{await o.$J.updateInventoryItem(a,r)}catch(e){throw console.error("Error updating item:",e),Error(e instanceof Error?e.message:"Failed to update item")}},p=async a=>{if(!(0,o.Gg)()){let r=e.map(e=>e.id===a?{...e,deleted:!0,updatedAt:Date.now()}:e);t(r),l(s.INVENTORY,r.filter(e=>!e.deleted));return}try{await o.$J.updateInventoryItem(a,{deleted:!0})}catch(e){throw console.error("Error deleting item:",e),Error(e instanceof Error?e.message:"Failed to delete item")}};return{items:(0,r.useMemo)(()=>e.filter(e=>!e.deleted),[e]),loading:a,error:d,addItem:f,updateItem:g,deleteItem:p,isConfigured:(0,o.Gg)()}}function d(){let[e,t]=(0,r.useState)([]),[a,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e;if(!(0,o.Gg)()||!o.OO){console.log("Firebase not available, using local storage for scans");let e=i(s.SCANS);if(e&&e.length>0)t(e);else{let e=[{id:"scan_1",barcode:"1234567890123",deviceId:"ESP32_001",timestamp:Date.now()-12e4,processed:!0,itemFound:!0,itemId:"mock_1"},{id:"scan_2",barcode:"9876543210987",deviceId:"ESP32_001",timestamp:Date.now()-3e5,processed:!0,itemFound:!0,itemId:"mock_2"}];t(e),l(s.SCANS,e)}u(null),c(!1);return}let a=(0,n.KR)(o.OO,"scans");return e=(0,n.Zy)(a,e=>{let a=e.val();t((a?Object.keys(a).map(e=>({...a[e],id:e})):[]).sort((e,t)=>(t.timestamp||0)-(e.timestamp||0))),u(null),c(!1)},e=>{console.error("Firebase scans error:",e),u(e.message),c(!1)}),()=>{e&&e()}},[]);let f=async a=>{if(!(0,o.Gg)()){let r={...a,id:"scan_".concat(Date.now()),timestamp:Date.now(),processed:!1},n=[r,...e.slice(0,99)];return t(n),l(s.SCANS,n),r.id}try{return await o.$J.addScanRecord(a)}catch(e){throw console.error("Error adding scan:",e),Error("Failed to add scan record")}};return{scans:e,loading:a,error:d,addScan:f,isConfigured:(0,o.Gg)()}}function u(){let[e,t]=(0,r.useState)([]),[a,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e;if(!(0,o.Gg)()||!o.OO){let e=i(s.DEVICES);if(e&&e.length>0)t(e);else{let e=[{deviceId:"ESP32_001",status:"online",ipAddress:"192.168.1.100",lastSeen:Date.now(),scanCount:45,freeHeap:245760}];t(e),l(s.DEVICES,e)}u(null),c(!1);return}let a=(0,n.KR)(o.OO,"devices");return e=(0,n.Zy)(a,e=>{let a=e.val(),r=a?Object.keys(a).map(e=>({...a[e],deviceId:e})):[];console.log("\uD83D\uDD0D Firebase devices loaded:",r),r.forEach(e=>{console.log("\uD83D\uDCF1 Device ".concat(e.deviceId,":"),{firstSeen:e.firstSeen,status:e.status,lastSeen:e.lastSeen})}),t(r),u(null),c(!1)},e=>{console.error("Firebase devices error:",e),u(e.message),c(!1)}),()=>{e&&e()}},[]);let f=async(a,r)=>{if(!(0,o.Gg)()){let n=e.map(e=>e.deviceId===a?{...e,...r}:e);t(n),l(s.DEVICES,n);return}try{await o.$J.updateDeviceStatus(a,r)}catch(e){throw console.error("Error updating device status:",e),Error("Failed to update device status")}};return{devices:e,loading:a,error:d,updateDeviceStatus:f,isConfigured:(0,o.Gg)()}}function f(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(!0),[c,d]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e;if(!(0,o.Gg)()||!o.OO||!o.TF||!o.TF.transactions){console.warn("Firebase not configured or transactions ref not available for useFirebaseTransactions.");let e=i(s.TRANSACTIONS);e&&e.length>0?t(e.map(e=>({...e,timestamp:e.timestamp||Date.now()}))):t([]),l(!1);return}let a=(0,n.P)(o.TF.transactions,(0,n.kT)("timestamp"));return e=(0,n.Zy)(a,e=>{let a=e.val();t((a?Object.keys(a).map(e=>({...a[e],id:e})):[]).sort((e,t)=>(t.timestamp||0)-(e.timestamp||0))),d(null),l(!1)},e=>{console.error("Firebase transactions error:",e),d(e.message),l(!1)}),()=>{e&&e()}},[]),{transactions:e,loading:a,error:c,isConfigured:(0,o.Gg)()}}function g(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(!0),[i,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e;if(!(0,o.Gg)()||!o.OO){console.warn("Firebase not configured for attendance"),s(!1);return}let a=(0,n.KR)(o.OO,"attendance"),r=(0,n.P)(a,(0,n.kT)("timestamp"));return e=(0,n.Zy)(r,e=>{let a=e.val();t((a?Object.keys(a).map(e=>({...a[e],id:e})):[]).sort((e,t)=>(t.timestamp||0)-(e.timestamp||0))),l(null),s(!1)},e=>{console.error("Firebase attendance error:",e),l(e.message),s(!1)}),()=>{e&&e()}},[]),{attendance:e,loading:a,error:i,addAttendance:async(e,t,a)=>{if(!(0,o.Gg)()||!o.OO)throw Error("Firebase not configured");try{let r=(0,n.KR)(o.OO,"attendance"),s=(0,n.VC)(r),i={nim:e,nama:t||"",timestamp:Date.now(),deviceId:a||"web",sessionId:"seminar-2025",eventName:"Seminar Teknologi 2025",location:"Auditorium Utama",scanned:!0};return await (0,n.hZ)(s,{...i,id:s.key}),i}catch(e){throw console.error("Error adding attendance:",e),e}},isConfigured:(0,o.Gg)()}}},3580:(e,t,a)=>{a.d(t,{dj:()=>f,oR:()=>u});var r=a(2115);let n=0,o=new Map,s=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),d({type:"REMOVE_TOAST",toastId:e})},5e3);o.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?s(a):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function d(e){c=i(c,e),l.forEach(e=>{e(c)})}function u(e){let{...t}=e,a=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>d({type:"DISMISS_TOAST",toastId:a});d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,duration:t.duration||5e3,onOpenChange:e=>{e||r()}}});let o=t.duration||5e3;return o>0&&setTimeout(()=>{r()},o),{id:a,dismiss:r,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function f(){let[e,t]=r.useState(c);return r.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},3999:(e,t,a)=>{a.d(t,{cn:()=>o});var r=a(2596),n=a(9688);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.QP)((0,r.$)(t))}},8915:(e,t,a)=>{a.d(t,{$J:()=>m,Gg:()=>h,OO:()=>c,TF:()=>u,m6:()=>b,mM:()=>v});var r=a(3915),n=a(1115),o=a(6203);let s={apiKey:"AIzaSyBDMTHkz_BwbqKfkVQYvKEI3yfrOLa_jLY",authDomain:"barcodescanesp32.firebaseapp.com",databaseURL:"https://barcodescanesp32-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"barcodescanesp32",storageBucket:"barcodescanesp32.firebasestorage.app",messagingSenderId:"330721800882",appId:"1:330721800882:web:ff7e05a769ab6cd32ccfab",measurementId:"G-C2L2NFF1C2"},i=()=>{let e=["apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId"].filter(e=>!s[e]);return e.length>0?(console.error("❌ Firebase configuration incomplete. Missing fields:",e),console.error("\uD83D\uDCA1 Please check your .env.local file and ensure all required environment variables are set."),!1):s.apiKey.startsWith("AIza")?s.authDomain.includes("firebaseapp.com")?(console.log("✅ Firebase configuration validated successfully"),!0):(console.error("❌ Invalid Firebase auth domain"),!1):(console.error("❌ Invalid Firebase API key format"),!1)},l=null,c=null,d=!1,u=null,f=async()=>{try{if(!navigator.onLine)return console.log("\uD83C\uDF10 Browser reports offline"),!1;return await fetch("https://www.google.com/favicon.ico",{mode:"no-cors",cache:"no-cache",signal:AbortSignal.timeout(5e3)}),!0}catch(e){return console.log("\uD83C\uDF10 Network connectivity check failed:",e),!1}},g=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>3){console.warn("\uD83D\uDD25 Max retries reached for Firebase initialization");return}if(!await f()&&e<3){console.log("\uD83D\uDD25 No network connectivity, retrying in ".concat((e+1)*2,"s...")),setTimeout(()=>g(e+1),(e+1)*2e3);return}try{p(),console.log("\uD83D\uDD25 Firebase initialized successfully with network check")}catch(t){console.error("\uD83D\uDD25 Firebase initialization failed:",t),e<3&&setTimeout(()=>g(e+1),(e+1)*2e3)}},p=()=>{if(!i()){console.error("\uD83D\uDD25 Firebase initialization aborted due to invalid configuration");return}l=0===(0,r.Dk)().length?(0,r.Wp)(s):(0,r.Dk)()[0];try{c=(0,n.C3)(l),(0,o.xI)(l),d=!0,c&&(u={inventory:(0,n.KR)(c,"inventory"),scans:(0,n.KR)(c,"scans"),devices:(0,n.KR)(c,"devices"),settings:(0,n.KR)(c,"settings"),analytics:(0,n.KR)(c,"analytics"),transactions:(0,n.KR)(c,"transactions"),attendance:(0,n.KR)(c,"attendance")}),console.log("✅ Firebase initialized successfully");{let e=console.error;console.error=function(){for(var t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];let n=a.join(" ");if(n.includes("ERR_NAME_NOT_RESOLVED")&&n.includes("firebasedatabase.app")){console.warn("\uD83D\uDD25 Firebase WebSocket connection issue (will retry):",a[0]);return}e.apply(console,a)}}}catch(e){console.warn("⚠️ Firebase database service not available:",e),c=null,u=null,d=!1}};"requestIdleCallback"in window?requestIdleCallback(()=>{g()},{timeout:2e3}):setTimeout(()=>{g()},100),window.addEventListener("online",()=>{console.log("\uD83C\uDF10 Network came back online, reinitializing Firebase"),h()||g()});let m={addInventoryItem:async e=>{if(!c||!u||!u.inventory)throw console.error("Firebase not available or inventory ref not initialized for addInventoryItem"),Error("Firebase not available - using local storage or operation failed");try{let t=(0,n.VC)(u.inventory);return await (0,n.hZ)(t,{...e,id:t.key,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)()}),t.key}catch(e){throw console.error("Error adding inventory item:",e),e}},updateInventoryItem:async(e,t)=>{if(!c)throw console.error("Firebase database not available for updateInventoryItem"),Error("Firebase not available - operation failed");try{let a=(0,n.KR)(c,"inventory/".concat(e));await (0,n.yo)(a,{...t,updatedAt:(0,n.O5)()})}catch(e){throw console.error("Error updating inventory item:",e),e}},addScanRecord:async e=>{if(!c||!u||!u.scans)throw console.error("Firebase not available or scans ref not initialized for addScanRecord"),Error("Firebase not available - using local storage or operation failed");try{let t=(0,n.VC)(u.scans);return await (0,n.hZ)(t,{...e,id:t.key,timestamp:(0,n.O5)(),processed:!1}),t.key}catch(e){throw console.error("Error adding scan record:",e),e}},updateDeviceStatus:async(e,t)=>{if(!c)throw console.error("Firebase database not available for updateDeviceStatus"),Error("Firebase not available - using local storage or operation failed");try{let a=(0,n.KR)(c,"devices/".concat(e));await (0,n.hZ)(a,{...t,lastSeen:(0,n.O5)()})}catch(e){throw console.error("Error updating device status:",e),e}},addAnalytics:async(e,t)=>{if(!c||!u||!u.analytics)throw console.error("Firebase not available or analytics ref not initialized for addAnalytics"),Error("Firebase not available - using local storage or operation failed");try{let a=(0,n.KR)(c,"analytics/".concat(e)),r=(0,n.VC)(a);await (0,n.hZ)(r,{...t,timestamp:(0,n.O5)()})}catch(e){throw console.error("Error adding analytics data:",e),e}},addTransaction:async e=>{if(!c||!u||!u.transactions)throw console.error("Firebase not available or transactions ref not initialized for addTransaction"),Error("Firebase not available - operation failed");try{let t=(0,n.VC)(u.transactions);return await (0,n.hZ)(t,{...e,id:t.key,timestamp:(0,n.O5)()}),t.key}catch(e){throw console.error("Error adding transaction:",e),e}}};class y{addListener(e){this.listeners.push(e)}cleanup(){console.log("\uD83D\uDD25 Cleaning up Firebase listeners...",this.listeners.length),this.listeners.forEach(e=>{try{e()}catch(e){console.warn("Error cleaning up Firebase listener:",e)}}),this.listeners=[]}constructor(){this.listeners=[]}}let b=new y;window.addEventListener("pagehide",()=>{console.log("\uD83D\uDD25 Page hiding, cleaning up Firebase connections..."),b.cleanup()}),window.addEventListener("visibilitychange",()=>{document.hidden&&(console.log("\uD83D\uDD25 Page hidden, cleaning up Firebase connections..."),b.cleanup())});let h=()=>d&&!!l&&!!c&&s.apiKey&&s.authDomain&&s.databaseURL&&s.projectId,v=()=>{let e=!!(s.apiKey&&s.authDomain&&s.databaseURL&&s.projectId);return{initialized:d,available:d&&!!c,configured:e,hasValidConfig:!!s.databaseURL,databaseUrl:s.databaseURL}}}}]);